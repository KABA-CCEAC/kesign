- var path = '../'
!!! 5
html(lang="en")
  head
    include ../includes/layout/head

    script(src='http://d3js.org/d3.v3.min.js')

    style
      /* bar chart */
      .axis path,
      .axis line {
        fill: none;
        stroke: #000;
        shape-rendering: crispEdges;
      }

      .bar {
        fill: steelblue;
      }

      .x.axis path {
        display: none;
      }

  body
    header.header
      .header-inner
        .brandbar.brandbar-xsmall.collapse.in
            a.brand(href="#{path}index.html")

            .statusbar.pull-right
              strong Welcome 
              | John Mustermann 
              span.label.label-warning Admin Status

        .navbar
          include ../includes/sample-navbar

          
    .main
      .main-inner
        .container
          .page.page-report
            .report
              .report-brandbar
                img.brand(src="#{path}public/img/kaba.gif")
                p.report-source Customer's Company, ...

              .report-title
                h1 Report Name
                  small  more optional info
                .report-info
                  span Some additional information
                  span.pull-right Hans Muster - 13422

              .report-section
                .row-fluid
                  .span12
                    h4 This is a section
                    table.table.table-condensed
                      thead
                        tr
                          th First row
                          th Text
                          th.right Decimal
                          th.center Centered
                          th Date / Times
                      tbody
                        tr
                          td.right 1212.125
                          td Ci dolor re porum dus
                          td.right 145.5 h
                          td.center #456
                          td 23.12.2012 09:15
                        tr
                          td.right 4567.897
                          td Lorem ipsum dolor sit amet
                          td.right 45.5 h
                          td.center #456
                          td 24.12.2012 10:30
                        tr.highlight
                          td.right 123453.433
                          td Duis autem vel eum iriure dolor in hendrerit in vulputate velit esse molestie consequat
                          td.right 122.0 h
                          td.center #456
                          td 25.12.2012 07:45
                        tr
                          td.right 19.190
                          td Claritas est etiam processus dynamicus
                          td.right 15.5 h
                          td.center #456
                          td 26.12.2012 09:00
                        tr
                          td.right 99.340
                          td Typi non habent claritatem insitam
                          td.right 140.0 h
                          td.center #456
                          td 27.12.2012 08:15
                        tr
                          td.right 13423.843
                          td Eodem modo typi, qui nunc nobis videntur parum clari, fiant sollemnes in futurum
                          td.right 145.5 h
                          td.center #456
                          td 28.12.2012 09:00
                        tr
                          td.right 8832.334
                          td Nam liber tempor cum soluta
                          td.right 45.5 h
                          td.center #456
                          td 29.12.2012 11:00
                        tr
                          td.right 123.453
                          td illum dolore eu feugiat nulla facilisis 
                          td.right 5.5 h
                          td.center #456
                          td 30.12.2012 10:15
                      tfoot
                        tr
                          td Saldo
                          td
                          td.right 1205.5 h
                          td.center
                          td

              .report-section
                .row-fluid
                  .span6
                    h4 This is a section
                    table.table.table-condensed
                      thead
                        tr
                          th First row
                          th Text
                          th.right Decimal
                      tbody
                        tr
                          td.right 1212.125
                          td Ci dolor re porum dus
                          td.right 145.5 h
                        tr
                          td.right 4567.897
                          td Lorem ipsum dolor sit amet
                          td.right.error -45.5 h
                        tr
                          td.right 19.190
                          td Claritas est etiam processus dynamicus
                          td.right.warning 15.5 h
                        tr
                          td.right 99.340
                          td Typi non habent claritatem insitam
                          td.right.success 140.0 h
                        tr
                          td.right 123453.433
                          td Duis autem vel eum iriure dolor in hendrerit in vulputate velit esse molestie consequat
                          td.right 122.0 h

                  .span6
                    h5 This is a secondary section
                    table.table.table-condensed
                      thead
                        tr
                          th First row
                          th Text
                          th.right Decimal
                      tbody
                        tr
                          td.right 1212.125
                          td Ci dolor re porum dus
                          td.right 145.5 h
                        tr
                          td.right 4567.897
                          td Lorem ipsum dolor sit amet
                          td.right 45.5 h
                        tr
                          td.right 123453.433
                          td Duis autem vel eum iriure dolor in hendrerit in vulputate velit esse molestie consequat.
                          td.right 122.0 h
                        tr
                          td.right 19.190
                          td Claritas est etiam processus dynamicus
                          td.right 15.5 h
                        tr
                          td.right 99.340
                          td Typi non habent claritatem insitam
                          td.right 140.0 h
                      tfoot
                        tr
                          td Saldo
                          td
                          td.right 405.5 h

              .report-section
                .row-fluid
                  .span6
                    h4 This is a chart section
                    .report-chart
                      #barchart
                  .span6
                    h4 This is a section
                    table.table.table-condensed
                      thead
                        tr
                          th First row
                          th Text
                          th.right Decimal
                      tbody
                        tr
                          td.right 1212.125
                          td Ci dolor re porum dus
                          td.right 145.5 h
                        tr.error
                          td.right 4567.897
                          td Lorem ipsum dolor sit amet
                          td.right.error -45.5 h
                        tr.warning
                          td.right 19.190
                          td Claritas est etiam processus dynamicus
                          td.right.warning 15.5 h
                        tr.success
                          td.right 99.340
                          td Typi non habent claritatem insitam
                          td.right.success 140.0 h
                        tr
                          td.right 123453.433
                          td Duis autem vel eum iriure dolor in hendrerit in vulputate velit esse molestie consequat
                          td.right 122.0 h

              .report-section
                .well.well-kabaBackgroundGray
                  .row-fluid
                    .span12
                      h4 This is a section
                      table.table.table-condensed
                        thead
                          tr
                            th First row
                            th Text
                            th.right Decimal
                            th.center Centered
                            th Date / Times
                        tbody
                          tr
                            td.right 1212.125
                            td Ci dolor re porum dus
                            td.right 145.5 h
                            td.center #456
                            td 23.12.2012 09:15
                          tr
                            td.right 4567.897
                            td Lorem ipsum dolor sit amet
                            td.right 45.5 h
                            td.center #456
                            td 24.12.2012 10:30
                          tr
                            td.right 123453.433
                            td Duis autem vel eum iriure dolor in hendrerit in vulputate velit esse molestie consequat
                            td.right 122.0 h
                            td.center #456
                            td 25.12.2012 07:45
                          tr
                            td.right 123.453
                            td illum dolore eu feugiat nulla facilisis 
                            td.right 5.5 h
                            td.center #456
                            td 30.12.2012 10:15
                        tfoot
                          tr
                            td Saldo
                            td
                            td.right 1205.5 h
                            td.center
                            td

    footer.footer
      .footer-inner
          | kesign is freely distributable under the terms of the MIT license.
    
    include ../includes/layout/endscripts

    script(type="text/javascript")
      // barchart
      (function() {
        var margin = {top: 20, right: 20, bottom: 30, left: 40},
        width = $('#barchart').width() - margin.left - margin.right,
        height = width * 0.6 - margin.top - margin.bottom;

        var x0 = d3.scale.ordinal()
            .rangeRoundBands([0, width], .1);

        var x1 = d3.scale.ordinal();

        var y = d3.scale.linear()
            .range([height, 0]);

        var color = d3.scale.ordinal()
            .range(["#F2A200", "#04284D", "#8D97A6", "#D5DBE0", "#CCCCCC", "#808080", "#4C4C4C"]);

        var xAxis = d3.svg.axis()
            .scale(x0)
            .orient("bottom");

        var yAxis = d3.svg.axis()
            .scale(y)
            .orient("left")
            .tickFormat(d3.format(".2s"));

        var svg = d3.select("#barchart").append("svg")
            .attr("width", width + margin.left + margin.right)
            .attr("height", height + margin.top + margin.bottom)
          .append("g")
            .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

        d3.csv("#{path}public/data/barchart-reduced.csv", function(error, data) {
          var ageNames = d3.keys(data[0]).filter(function(key) { return key !== "State"; });

          data.forEach(function(d) {
            d.ages = ageNames.map(function(name) { return {name: name, value: +d[name]}; });
          });

          x0.domain(data.map(function(d) { return d.State; }));
          x1.domain(ageNames).rangeRoundBands([0, x0.rangeBand()]);
          y.domain([0, d3.max(data, function(d) { return d3.max(d.ages, function(d) { return d.value; }); })]);

          svg.append("g")
              .attr("class", "x axis")
              .attr("transform", "translate(0," + height + ")")
              .call(xAxis);

          svg.append("g")
              .attr("class", "y axis")
              .call(yAxis)
            .append("text")
              .attr("transform", "rotate(-90)")
              .attr("y", 6)
              .attr("dy", ".71em")
              .style("text-anchor", "end")
              .text("Population");

          var state = svg.selectAll(".state")
              .data(data)
            .enter().append("g")
              .attr("class", "g")
              .attr("transform", function(d) { return "translate(" + x0(d.State) + ",0)"; });

          state.selectAll("rect")
              .data(function(d) { return d.ages; })
            .enter().append("rect")
              .attr("width", x1.rangeBand())
              .attr("x", function(d) { return x1(d.name); })
              .attr("y", function(d) { return y(d.value); })
              .attr("height", function(d) { return height - y(d.value); })
              .style("fill", function(d) { return color(d.name); });

          var legend = svg.selectAll(".legend")
              .data(ageNames.slice().reverse())
            .enter().append("g")
              .attr("class", "legend")
              .attr("transform", function(d, i) { return "translate(0," + i * 20 + ")"; });

          legend.append("rect")
              .attr("x", width - 18)
              .attr("width", 18)
              .attr("height", 18)
              .style("fill", color);

          legend.append("text")
              .attr("x", width - 24)
              .attr("y", 9)
              .attr("dy", ".35em")
              .style("text-anchor", "end")
              .text(function(d) { return d; });

        });
      })();

